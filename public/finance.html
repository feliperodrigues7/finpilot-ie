<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinPilot IE - Financeiro Pessoal</title>
  <link rel="icon" href="./favicon.ico" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
    .tab-button.active { background:#2563eb; color:#fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
    .modal-content { background-color: #fff; margin: 6% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 640px; border-radius: 8px; position: relative; }
    .close-button { color: #666; position:absolute; right:16px; top:12px; font-size: 24px; font-weight: bold; cursor:pointer; }
    .toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 12px 16px; position: fixed; z-index: 1500; left: 50%; bottom: 30px; font-size: 15px; }
    .toast.show { visibility: visible; animation: fadein 0.4s, fadeout 0.4s 2.6s; }
    @keyframes fadein { from {bottom: 10px; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 10px; opacity: 0;} }
  </style>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold">FinPilot IE - Financeiro Pessoal</h1>
      <div class="flex items-center space-x-4">
        <select id="owner-filter" class="p-2 border rounded">
          <option value="">Todas as Pessoas</option>
        </select>
        <button id="logout-button" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">Sair</button>
      </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
      <div class="flex border-b border-gray-200 overflow-x-auto">
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600 active" data-tab="dashboard">Dashboard</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="accounts">Contas</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="transactions">Transações</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="categories">Categorias</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="recurring">Recorrentes</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="budgets">Orçamento</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="debts">Dívidas</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="reports">Relatórios</button>
        <button class="tab-button py-2 px-4 text-gray-700 hover:text-blue-600" data-tab="settings">Configurações</button>
      </div>

      <div id="dashboard" class="tab-content active p-4">
        <h2 class="text-2xl font-semibold mb-4">Dashboard</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg shadow">
            <h3 class="font-bold text-lg">Saldo Total</h3>
            <p id="total-balance" class="text-3xl font-extrabold text-blue-700">€0.00</p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg shadow">
            <h3 class="font-bold text-lg">Receitas Mês</h3>
            <p id="monthly-income" class="text-3xl font-extrabold text-green-700">€0.00</p>
          </div>
          <div class="bg-red-50 p-4 rounded-lg shadow">
            <h3 class="font-bold text-lg">Despesas Mês</h3>
            <p id="monthly-expenses" class="text-3xl font-extrabold text-red-700">€0.00</p>
          </div>
        </div>
        <div class="mt-6">
          <h3 class="text-xl font-semibold mb-3">Próximas Recorrências</h3>
          <ul id="upcoming-recurring-list" class="space-y-2"></ul>
        </div>
      </div>

      <div id="accounts" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Contas</h2>
        <button id="add-account-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Adicionar Conta</button>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Nome</th>
                <th class="py-2 px-4 border-b">Saldo</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="accounts-table-body">
              <tr><td colspan="4" class="text-center py-4 text-gray-500">Nenhuma conta cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="transactions" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Transações</h2>
        <div class="flex justify-between items-center mb-4">
          <button id="add-transaction-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Adicionar Transação</button>
          <div class="flex space-x-2">
            <input type="date" id="transaction-start-date" class="p-2 border rounded" />
            <input type="date" id="transaction-end-date" class="p-2 border rounded" />
            <input type="text" id="transaction-search" placeholder="Buscar..." class="p-2 border rounded" />
            <button id="export-transactions-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Exportar CSV</button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Data</th>
                <th class="py-2 px-4 border-b">Descrição</th>
                <th class="py-2 px-4 border-b">Valor</th>
                <th class="py-2 px-4 border-b">Conta</th>
                <th class="py-2 px-4 border-b">Categoria</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="transactions-table-body">
              <tr><td colspan="7" class="text-center py-4 text-gray-500">Nenhuma transação cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="categories" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Categorias</h2>
        <button id="add-category-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Adicionar Categoria</button>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Nome</th>
                <th class="py-2 px-4 border-b">Tipo</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="categories-table-body">
              <tr><td colspan="4" class="text-center py-4 text-gray-500">Nenhuma categoria cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="recurring" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Recorrentes</h2>
        <button id="add-recurring-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Adicionar Recorrência</button>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Título</th>
                <th class="py-2 px-4 border-b">Valor</th>
                <th class="py-2 px-4 border-b">Frequência</th>
                <th class="py-2 px-4 border-b">Próximo</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="recurring-table-body">
              <tr><td colspan="6" class="text-center py-4 text-gray-500">Nenhuma recorrência cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="budgets" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Orçamento</h2>
        <div class="flex items-center mb-4">
          <input type="month" id="budget-month" class="p-2 border rounded mr-2" />
          <button id="add-budget-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Definir Orçamento</button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Categoria</th>
                <th class="py-2 px-4 border-b">Mês</th>
                <th class="py-2 px-4 border-b">Valor</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="budgets-table-body">
              <tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhum orçamento cadastrado.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="debts" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Dívidas</h2>
        <button id="add-debt-button" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">Adicionar Dívida</button>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200">
            <thead>
              <tr>
                <th class="py-2 px-4 border-b">Pessoa</th>
                <th class="py-2 px-4 border-b">Credor</th>
                <th class="py-2 px-4 border-b">Valor</th>
                <th class="py-2 px-4 border-b">Vencimento</th>
                <th class="py-2 px-4 border-b">Status</th>
                <th class="py-2 px-4 border-b">Ações</th>
              </tr>
            </thead>
            <tbody id="debts-table-body">
              <tr><td colspan="6" class="text-center py-4 text-gray-500">Nenhuma dívida cadastrada.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="reports" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Relatórios</h2>
        <div class="flex items-center mb-4">
          <input type="month" id="report-month" class="p-2 border rounded mr-2" />
        </div>
        <p class="text-gray-500">(Gráficos opcionais)</p>
      </div>

      <div id="settings" class="tab-content p-4">
        <h2 class="text-2xl font-semibold mb-4">Configurações</h2>
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-3">Gerenciar Pessoas</h3>
          <div class="flex mb-2">
            <input type="text" id="new-person-name" placeholder="Nome da Pessoa" class="p-2 border rounded flex-grow mr-2" />
            <button id="add-person-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Adicionar</button>
          </div>
          <ul id="people-list" class="list-disc pl-5"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Modais -->
  <div id="account-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="account-modal-title" class="text-xl font-semibold mb-4">Adicionar Conta</h3>
    <form id="account-form">
      <input type="hidden" id="account-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="account-owner-name">Pessoa</label>
        <select id="account-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="account-name">Nome da Conta</label>
        <input id="account-name" type="text" class="border rounded w-full p-2" required />
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="account-balance">Saldo Inicial</label>
        <input id="account-balance" type="number" step="0.01" class="border rounded w-full p-2" required />
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="transaction-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="transaction-modal-title" class="text-xl font-semibold mb-4">Adicionar Transação</h3>
    <form id="transaction-form">
      <input type="hidden" id="transaction-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="transaction-owner-name">Pessoa</label>
        <select id="transaction-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="transaction-date">Data</label>
        <input id="transaction-date" type="date" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="transaction-description">Descrição</label>
        <input id="transaction-description" type="text" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="transaction-amount">Valor</label>
        <input id="transaction-amount" type="number" step="0.01" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="transaction-account">Conta</label>
        <select id="transaction-account" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="transaction-category">Categoria</label>
        <select id="transaction-category" class="border rounded w-full p-2"></select>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="category-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="category-modal-title" class="text-xl font-semibold mb-4">Adicionar Categoria</h3>
    <form id="category-form">
      <input type="hidden" id="category-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="category-owner-name">Pessoa</label>
        <select id="category-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="category-name">Nome</label>
        <input id="category-name" type="text" class="border rounded w-full p-2" />
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="category-type">Tipo</label>
        <select id="category-type" class="border rounded w-full p-2">
          <option value="expense">Despesa</option>
          <option value="income">Receita</option>
        </select>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="recurring-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="recurring-modal-title" class="text-xl font-semibold mb-4">Adicionar Recorrência</h3>
    <form id="recurring-form">
      <input type="hidden" id="recurring-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="recurring-owner-name">Pessoa</label>
        <select id="recurring-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="recurring-title">Título</label>
        <input id="recurring-title" type="text" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="recurring-amount">Valor</label>
        <input id="recurring-amount" type="number" step="0.01" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="recurring-frequency">Frequência</label>
        <select id="recurring-frequency" class="border rounded w-full p-2">
          <option value="weekly">Semanal</option>
          <option value="biweekly">Quinzenal</option>
          <option value="monthly">Mensal</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="recurring-account">Conta</label>
        <select id="recurring-account" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="recurring-category">Categoria</label>
        <select id="recurring-category" class="border rounded w-full p-2"></select>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="budget-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="budget-modal-title" class="text-xl font-semibold mb-4">Definir Orçamento</h3>
    <form id="budget-form">
      <input type="hidden" id="budget-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="budget-owner-name">Pessoa</label>
        <select id="budget-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="budget-month-input">Mês</label>
        <input id="budget-month-input" type="month" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="budget-category">Categoria</label>
        <select id="budget-category" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="budget-amount">Valor</label>
        <input id="budget-amount" type="number" step="0.01" class="border rounded w-full p-2" />
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="debt-modal" class="modal"><div class="modal-content"><span class="close-button">&times;</span>
    <h3 id="debt-modal-title" class="text-xl font-semibold mb-4">Adicionar Dívida</h3>
    <form id="debt-form">
      <input type="hidden" id="debt-id" />
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="debt-owner-name">Pessoa</label>
        <select id="debt-owner-name" class="border rounded w-full p-2"></select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="debt-creditor">Credor</label>
        <input id="debt-creditor" type="text" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="debt-amount">Valor</label>
        <input id="debt-amount" type="number" step="0.01" class="border rounded w-full p-2" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-semibold mb-1" for="debt-due-date">Vencimento</label>
        <input id="debt-due-date" type="date" class="border rounded w-full p-2" />
      </div>
      <div class="mb-4">
        <label class="block text-sm font-semibold mb-1" for="debt-status">Status</label>
        <select id="debt-status" class="border rounded w-full p-2">
          <option value="pendente">Pendente</option>
          <option value="pago">Pago</option>
        </select>
      </div>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Salvar</button>
    </form>
  </div></div>

  <div id="toast" class="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="./finance.js"></script>
</body>
</html>
